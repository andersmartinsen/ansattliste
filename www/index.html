<!DOCTYPE>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
            <meta http-equiv="Content-type" content="text/html; charset=utf-8">
                <meta name="apple-mobile-web-app-capable" content="yes">
                    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0rc1/jquery.mobile-1.0rc1.min.css" />
                    <script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
                    <script src="http://code.jquery.com/mobile/1.0rc1/jquery.mobile-1.0rc1.min.js"></script>
                    <script src="mustache.js" type="text/javascript">
                        </script>
                    <script src="underscore-min.js" type="text/javascript">
                        </script>
                    </head>
	<body>
		<div data-role="page">
			<div data-role="header">
				<h1>Kontaktliste<h1>
                    </div>
			<div data-role="content">
				<form action="#" id="new-contact-form" data-ajax="false">
					<div data-role="fieldcontain">
						<label for="name">Navn:</label>
						<input type="text" id="name" />
					</div>
					<div data-role="fieldcontain">
						<label for="number">Tlf.nr</label>
						<input type="number" id="number" />
					</div>
					<div data-role="fieldcontain">
						<input type="submit" value="Lagre" />
					</div>
				</form>
				<div style="clear:both; height:10px;"></div>
				<ul id="contact-list" data-role="listview">
				</ul>
			</div>
			<script>
				$(function(){
                  window.App = {
                  contactTemplate: "<li><a href='#'><h1>{{name}}</h1><p>{{number}}</p></a></li>",
                  data: function(){
                  var store = localStorage.getItem('contacts');
                  return (store && JSON.parse(store)) || {};
                  },
                  addContact: function(name, number){
                  var data = this.data();
                  data[number] = {name: name, number: number};
                  localStorage.setItem('contacts', JSON.stringify(data));
                  this.render();
                  },
                  allContacts: function(){
                  return _.values(this.data());
                  },
                  render: function(){
                  if (false){
                  localStorage.setItem("contacts", JSON.stringify({}));
                  }
                  var html = _.reduce(this.allContacts(), function(memo, contact){
                                      return memo + Mustache.to_html(App.contactTemplate, contact);
                                      }, "");
                  $("#contact-list").html(html).listview("refresh");
                  }
                  };
                  $("#new-contact-form").live("submit", function(e){
                                              App.addContact($("#name").val(), $("#number").val());
                                              e.preventDefault();
                                              e.stopPropagation();
                                              return false;
                                              });
                  App.render();
                  });
                </script>
		</div>
	</body>
</html>