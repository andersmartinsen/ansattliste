<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0rc1/jquery.mobile-1.0rc1.min.css" />
		<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.0rc1/jquery.mobile-1.0rc1.min.js"></script>
		<script src="mustache.js" type="text/javascript">
</script>
		<script src="underscore-min.js" type="text/javascript">
</script>
	</head>
	<body>
		<div data-role="page">
			<div data-role="header">
				<h1>Kontaktliste<h1>
			</div>
			<div data-role="content">
				<form action="" id="new-contact-form">
					<label for="name">Navn:</label>
					<input type="text" id="name" />
					<label for="number">Tlf.nr</label>
					<input type="number" id="number" />
					<input type="submit" value="Lagre" />
				</form>
				<ul id="contact-list" data-role="listview">
				</ul>
			</div>
			<script>
				$(function(){
					window.App = {
						init: function(){
							console.log("init");
							localStorage.setItem( 'contacts', JSON.stringify({list: []}) );
						},
						contactsTemplate: "{{#contacts}}<li><a href='#'><h1>{{name}}</h1><p>{{number}}</p></a></li>{{/contacts}}",
						addContact: function(name, number){
							var contacts = JSON.parse(localStorage.getItem('contacts'));
							contacts.list.append({name: name, number: number});
							localStorage.setItem('contacts', JSON.stringify(contacts));
							console.log(Mustache.to_html(this.contactsTemplate, {contacts: contacts}));
							$("#contact-list").html(Mustache.to_html(this.contactsTemplate, {contacts: contacts})).listview("refresh");
						}
					};
					$("#new-contact-form").live("submit", function(e){
						console.log("in submit handler");
						App.addContact($("#name").val(), $("#number").val());
						console.log("after add contact");
						e.preventDefault();
						return false;
					});
					App.init();
				});
			</script>
		</div>
	</body>
</html>